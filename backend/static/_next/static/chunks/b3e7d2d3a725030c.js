(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18391,e=>{"use strict";let t=(0,e.i(12063).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],18391)},28648,e=>{"use strict";let t=(0,e.i(12063).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>t],28648)},41334,e=>{"use strict";let t=(0,e.i(12063).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],41334)},15398,e=>{"use strict";let t=(0,e.i(12063).default)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);e.s(["Lock",()=>t],15398)},92725,e=>{"use strict";var t=e.i(78722),a=e.i(89490),r=e.i(69244),s=e.i(18391),l=e.i(28648),n=e.i(10496),i=e.i(82874),d=e.i(15398),o=e.i(46362),c=e.i(41334),x=e.i(93409),m=e.i(93889),u=e.i(93637);function h(e){if(0===e)return"Zero";let t=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],a=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],r=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"];function s(e){return 0===e?"":e<10?t[e]:e<20?r[e-10]:e<100?a[Math.floor(e/10)]+(e%10!=0?" "+t[e%10]:""):t[Math.floor(e/100)]+" Hundred"+(e%100!=0?" and "+s(e%100):"")}let l=Math.floor(e/1e7),n=Math.floor(e%1e7/1e5),i=Math.floor(e%1e5/1e3),d=e%1e3,o="";return l>0&&(o+=s(l)+" Crore "),n>0&&(o+=s(n)+" Lakh "),i>0&&(o+=s(i)+" Thousand "),d>0&&(o+=s(d)),o.trim()}function p(e){let t=Math.floor(e),a=Math.round((e-t)*100),r="Rupees "+h(t);return a>0&&(r+=" and Paise "+h(a)),r+=" Only"}let b=({label:e,value:a,onChange:r,type:s="text",placeholder:l="",required:n=!1,readOnly:i=!1})=>(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsxs)("label",{className:"block text-[11px] uppercase tracking-wider font-semibold text-text-secondary",children:[e," ",n&&(0,t.jsx)("span",{className:"text-danger",children:"*"})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{type:s,value:a,onChange:r,readOnly:i,placeholder:l,className:`w-full px-3 py-2 text-sm border border-border rounded-lg focus:ring-1 focus:ring-primary focus:border-primary text-text-primary transition-colors ${i?"bg-gray-50 text-text-muted cursor-not-allowed":"bg-white"}`}),i&&(0,t.jsx)(d.Lock,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-text-muted opacity-50"})]})]});function y(){var e;let d=(0,r.useRouter)(),h=(0,r.useSearchParams)(),y=h?.get("dc")||"",[g,v]=(0,a.useState)(!1),[_,j]=(0,a.useState)(!1),[f,N]=(0,a.useState)(null),[C,w]=(0,a.useState)([]),[k,S]=(0,a.useState)(y),[T,F]=(0,a.useState)((e=y||void 0,{invoice_number:"",invoice_date:new Date().toISOString().split("T")[0],dc_number:e||"",buyer_name:"The Sr. Manager (CRX)",buyer_address:"M/S Bharat Heavy Eletrical Ltd. Bhopal",buyer_gstin:"",buyer_state:"Madhya Pradesh",buyer_state_code:"23",place_of_supply:"Madhya Pradesh",buyers_order_no:"",buyers_order_date:"",vehicle_no:"",lr_no:"",transporter:"",destination:"",terms_of_delivery:"",gemc_number:"",mode_of_payment:"",payment_terms:"45 Days",despatch_doc_no:"",srv_no:"",srv_date:"",remarks:""}));(0,a.useEffect)(()=>{y&&D(y)},[y]);let D=async e=>{if(e){v(!0),N(null);try{let t=await m.api.getDCDetail(e);if(!t||!t.header){N("Failed to load DC details. Check ID and try again."),v(!1);return}if(F(e=>({...e,dc_number:t.header.dc_number||"",challan_date:t.header.dc_date||"",buyers_order_no:t.header.po_number?.toString()||"",buyers_order_date:t.header.po_date||""})),t.items&&t.items.length>0){let e=t.items.map(e=>{let t=e.dispatched_quantity||e.dispatch_qty||e.dispatch_quantity||0,a=e.po_rate||0,r=t*a,s=9*r/100,l=9*r/100;return{lotNumber:e.lot_no?.toString()||"",description:e.description||e.material_description||"",hsnCode:e.hsn_code||"",quantity:t,unit:"NO",rate:a,taxableValue:r,tax:{cgstRate:9,cgstAmount:s,sgstRate:9,sgstAmount:l,igstRate:0,igstAmount:0},totalAmount:r+s+l}});w(e),A(e)}v(!1)}catch(e){console.error("Failed to fetch DC:",e),N(e instanceof Error?e.message:"Failed to load DC"),v(!1)}}},A=e=>{let t=e.reduce((e,t)=>({taxable:e.taxable+t.taxableValue,cgst:e.cgst+t.tax.cgstAmount,sgst:e.sgst+t.tax.sgstAmount,total:e.total+t.totalAmount}),{taxable:0,cgst:0,sgst:0,total:0});F(e=>({...e,taxable_value:t.taxable,cgst:t.cgst,sgst:t.sgst,total_invoice_value:t.total}))},M=(e,t,a)=>{let r=[...C],s=r[e];"quantity"===t&&(s.quantity=a),"rate"===t&&(s.rate=a),s.taxableValue=s.quantity*s.rate,s.tax.cgstAmount=s.taxableValue*s.tax.cgstRate/100,s.tax.sgstAmount=s.taxableValue*s.tax.sgstRate/100,s.totalAmount=s.taxableValue+s.tax.cgstAmount+s.tax.sgstAmount,w(r),A(r)},q=async()=>{if(!_){if(!T.invoice_number||!T.invoice_number.trim())return void N("Invoice Number is required");N(null),j(!0);try{let e={invoice_number:T.invoice_number,invoice_date:T.invoice_date,dc_number:T.dc_number,buyer_name:T.buyer_name,buyer_gstin:T.buyer_gstin,buyer_state:T.buyer_state,place_of_supply:T.place_of_supply,buyers_order_no:T.buyers_order_no,buyers_order_date:T.buyers_order_date,vehicle_no:T.vehicle_no,lr_no:T.lr_no,transporter:T.transporter,destination:T.destination,terms_of_delivery:T.terms_of_delivery,gemc_number:T.gemc_number,mode_of_payment:T.mode_of_payment,payment_terms:T.payment_terms,despatch_doc_no:T.despatch_doc_no,srv_no:T.srv_no,srv_date:T.srv_date,remarks:T.remarks,items:C.map(e=>({po_sl_no:e.lotNumber,description:e.description,quantity:e.quantity,unit:e.unit,rate:e.rate,hsn_sac:e.hsnCode,no_of_packets:0}))},t=await m.api.createInvoice(e);t.invoice_number?d.push(`/invoice/view?id=${t.invoice_number}`):d.push("/invoice")}catch(e){console.error("Failed to create invoice:",e),N(e instanceof Error?e.message:"Failed to create invoice")}finally{j(!1)}}};return(0,t.jsxs)("div",{className:"space-y-6 pb-12",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("button",{onClick:()=>d.back(),className:"text-text-secondary hover:text-text-primary transition-colors p-1",children:(0,t.jsx)(s.ArrowLeft,{className:"w-5 h-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-bold text-text-primary flex items-center gap-3 tracking-tight",children:"Generate Tax Invoice"}),(0,t.jsx)("p",{className:"text-sm text-text-muted mt-0.5",children:"Create final GST invoice against Delivery Challan"})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 items-center",children:[!y&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(x.Search,{className:"w-4 h-4 absolute left-3 top-2.5 text-text-muted"}),(0,t.jsx)("input",{type:"text",value:k,onChange:e=>S(e.target.value),className:"w-48 pl-9 pr-3 py-2 text-sm border border-border rounded-lg bg-white focus:ring-1 focus:ring-primary focus:border-primary placeholder:text-text-muted/50",placeholder:"Enter DC No.",disabled:g})]}),(0,t.jsx)("button",{onClick:()=>D(k||""),disabled:g||!k,className:"px-3 py-2 bg-surface-2 text-text-primary border border-border rounded-lg hover:bg-surface-3 text-sm font-medium transition-colors disabled:opacity-50",children:g?"Fetching...":"Link DC"})]}),(0,t.jsx)("div",{className:"h-6 w-px bg-border mx-2"}),(0,t.jsx)("button",{onClick:()=>d.back(),className:"px-4 py-2 text-sm font-medium text-text-secondary bg-white border border-border rounded-lg hover:bg-gray-50 transition-colors",disabled:_,children:"Cancel"}),(0,t.jsx)("button",{onClick:q,disabled:_||0===C.length,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium shadow-sm transition-all flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:_?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.Loader2,{className:"w-4 h-4 animate-spin"})," Monthly"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Save,{className:"w-4 h-4"})," Finalize Invoice"]})})]})]}),f&&(0,t.jsxs)("div",{className:"bg-red-50 border border-red-100 rounded-lg p-3 flex items-start gap-3 text-danger",children:[(0,t.jsx)(c.AlertCircle,{className:"w-5 h-5 shrink-0 mt-0.5"}),(0,t.jsx)("p",{className:"text-sm font-medium",children:f})]}),g&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,t.jsx)(i.Loader2,{className:"w-10 h-10 animate-spin text-primary mb-4"}),(0,t.jsx)("p",{className:"text-text-secondary font-medium",children:"Fetching Challan Details..."})]}),!y&&0===C.length&&!g&&!k&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 border-2 border-dashed border-border rounded-xl bg-surface-1/50",children:[(0,t.jsx)(n.FileText,{className:"w-12 h-12 text-text-muted/50 mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-text-primary",children:"No Delivery Challan Linked"}),(0,t.jsx)("p",{className:"text-text-muted mb-6",children:"Enter a DC Number above to generate an invoice."})]}),y&&0===C.length&&!g&&(0,t.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-8 flex flex-col items-center text-center",children:[(0,t.jsx)(c.AlertCircle,{className:"w-10 h-10 text-amber-500 mb-3"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-amber-900",children:"No Items Found"}),(0,t.jsxs)("p",{className:"text-amber-700 mt-1 max-w-md",children:["We found the Delivery Challan ",(0,t.jsx)("strong",{children:y}),", but it appears to have no items or they could not be loaded."]}),(0,t.jsx)("button",{onClick:()=>D(y),className:"mt-4 px-4 py-2 bg-white border border-amber-300 text-amber-800 rounded-lg hover:bg-amber-100 transition-colors font-medium text-sm",children:"Try Reloading"})]}),C.length>0&&(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-6",children:[(0,t.jsx)(u.Card,{title:"Invoice & Despatch Details",padding:"md",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,t.jsx)(b,{label:"Invoice Number",value:T.invoice_number,onChange:e=>F({...T,invoice_number:e.target.value}),required:!0,placeholder:"e.g., INV/2024-25/001"}),(0,t.jsx)(b,{label:"Invoice Date",type:"date",value:T.invoice_date,onChange:e=>F({...T,invoice_date:e.target.value}),required:!0}),(0,t.jsx)(b,{label:"GEMC / E-way Bill",value:T.gemc_number||"",onChange:e=>F({...T,gemc_number:e.target.value}),placeholder:"Optional"}),(0,t.jsx)(b,{label:"Linked Challan",value:T.dc_number,readOnly:!0}),(0,t.jsx)("div",{className:"my-2 md:col-span-4 h-px bg-border/50"}),(0,t.jsx)(b,{label:"Challan Date",value:T.challan_date||"",readOnly:!0}),(0,t.jsx)(b,{label:"Buyer's Order No",value:T.buyers_order_no||"",readOnly:!0}),(0,t.jsx)(b,{label:"Buyer's Order Date",value:T.buyers_order_date||"",readOnly:!0}),(0,t.jsx)(b,{label:"Despatch Doc No",value:T.despatch_doc_no||"",onChange:e=>F({...T,despatch_doc_no:e.target.value})}),(0,t.jsx)(b,{label:"SRV No",value:T.srv_no||"",onChange:e=>F({...T,srv_no:e.target.value})}),(0,t.jsx)(b,{label:"SRV Date",type:"date",value:T.srv_date||"",onChange:e=>F({...T,srv_date:e.target.value})}),(0,t.jsx)("div",{className:"md:col-span-2",children:(0,t.jsx)(b,{label:"Buyer Name",value:T.buyer_name,onChange:e=>F({...T,buyer_name:e.target.value}),required:!0})}),(0,t.jsx)(b,{label:"Buyer GSTIN",value:T.buyer_gstin||"",onChange:e=>F({...T,buyer_gstin:e.target.value})}),(0,t.jsx)(b,{label:"State",value:T.buyer_state||"",onChange:e=>F({...T,buyer_state:e.target.value})}),(0,t.jsx)(b,{label:"Place of Supply",value:T.place_of_supply||"",onChange:e=>F({...T,place_of_supply:e.target.value})})]})}),(0,t.jsx)(u.Card,{title:"Transport & Payment",padding:"md",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,t.jsx)(b,{label:"Vehicle Number",value:T.vehicle_no||"",onChange:e=>F({...T,vehicle_no:e.target.value}),placeholder:"e.g., MP04-AA-1234"}),(0,t.jsx)(b,{label:"LR Number",value:T.lr_no||"",onChange:e=>F({...T,lr_no:e.target.value})}),(0,t.jsx)(b,{label:"Transporter",value:T.transporter||"",onChange:e=>F({...T,transporter:e.target.value})}),(0,t.jsx)(b,{label:"Destination",value:T.destination||"",onChange:e=>F({...T,destination:e.target.value})}),(0,t.jsx)(b,{label:"Terms of Delivery",value:T.terms_of_delivery||"",onChange:e=>F({...T,terms_of_delivery:e.target.value})}),(0,t.jsx)(b,{label:"Mode of Payment",value:T.mode_of_payment||"",onChange:e=>F({...T,mode_of_payment:e.target.value})}),(0,t.jsx)(b,{label:"Payment Terms",value:T.payment_terms||"",onChange:e=>F({...T,payment_terms:e.target.value})})]})}),(0,t.jsxs)(u.Card,{padding:"none",className:"overflow-hidden",children:[(0,t.jsx)("div",{className:"p-4 border-b border-border bg-gray-50/40 flex justify-between items-center",children:(0,t.jsxs)("h3",{className:"text-[14px] font-semibold text-text-primary flex items-center gap-2",children:[(0,t.jsx)(o.Package,{className:"w-4 h-4 text-primary"})," Invoice Items"]})}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-left",children:[(0,t.jsx)("thead",{className:"bg-surface-2 text-text-secondary font-semibold text-[11px] uppercase tracking-wider border-b border-border",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-3",children:"Lot No"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Description"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right text-text-primary w-24",children:"Qty"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Unit"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right w-32",children:"Rate"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right text-text-primary",children:"Taxable Value"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right",children:"CGST (9%)"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right",children:"SGST (9%)"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right text-text-primary",children:"Total"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-border/50 bg-white",children:C.map((e,a)=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-text-secondary font-mono",children:e.lotNumber}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-text-primary font-medium",children:e.description}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:(0,t.jsx)("input",{type:"number",value:0===e.quantity?"":e.quantity,onChange:e=>{let t=parseFloat(e.target.value);M(a,"quantity",isNaN(t)?0:t)},className:"w-20 text-right text-sm border border-border rounded px-2 py-1 focus:ring-1 focus:ring-primary focus:border-primary"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-text-secondary",children:e.unit}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:(0,t.jsx)("input",{type:"number",value:0===e.rate?"":e.rate,onChange:e=>{let t=parseFloat(e.target.value);M(a,"rate",isNaN(t)?0:t)},className:"w-28 text-right text-sm border border-border rounded px-2 py-1 focus:ring-1 focus:ring-primary focus:border-primary"})}),(0,t.jsxs)("td",{className:"px-4 py-3 text-sm text-text-primary text-right font-medium bg-gray-50/30",children:["₹",e.taxableValue.toFixed(2)]}),(0,t.jsxs)("td",{className:"px-4 py-3 text-sm text-text-secondary text-right",children:["₹",e.tax.cgstAmount.toFixed(2)]}),(0,t.jsxs)("td",{className:"px-4 py-3 text-sm text-text-secondary text-right",children:["₹",e.tax.sgstAmount.toFixed(2)]}),(0,t.jsxs)("td",{className:"px-4 py-3 text-sm text-text-primary text-right font-bold bg-primary/5",children:["₹",e.totalAmount.toFixed(2)]})]},a))})]})})]}),(0,t.jsx)(u.Card,{padding:"lg",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-text-secondary uppercase",children:"Amount in Words"}),(0,t.jsxs)("div",{className:"space-y-3 p-4 bg-gray-50 rounded-lg border border-border",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-text-secondary uppercase tracking-wider mb-1",children:"Taxable Amount"}),(0,t.jsx)("div",{className:"text-sm font-medium text-text-primary",children:p(T.taxable_value||0)})]}),(0,t.jsx)("div",{className:"h-px bg-border/50"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-text-secondary uppercase tracking-wider mb-1",children:"Total Invoice Value"}),(0,t.jsx)("div",{className:"text-sm font-bold text-primary",children:p(T.total_invoice_value||0)})]})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,t.jsx)("span",{className:"text-text-secondary",children:"Subtotal (Taxable)"}),(0,t.jsxs)("span",{className:"font-semibold text-text-primary",children:["₹",(T.taxable_value||0).toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,t.jsx)("span",{className:"text-text-secondary",children:"CGST Total (9%)"}),(0,t.jsxs)("span",{className:"font-semibold text-text-primary",children:["₹",(T.cgst||0).toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,t.jsx)("span",{className:"text-text-secondary",children:"SGST Total (9%)"}),(0,t.jsxs)("span",{className:"font-semibold text-text-primary",children:["₹",(T.sgst||0).toFixed(2)]})]}),(0,t.jsx)("div",{className:"h-px bg-border my-2"}),(0,t.jsxs)("div",{className:"flex justify-between items-center text-lg",children:[(0,t.jsx)("span",{className:"font-bold text-text-primary",children:"Grand Total"}),(0,t.jsxs)("span",{className:"font-bold text-primary",children:["₹",(T.total_invoice_value||0).toFixed(2)]})]})]})]})})]})]})}function g(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"p-12 text-center text-text-muted",children:"Loading Editor..."}),children:(0,t.jsx)(y,{})})}e.s(["default",()=>g],92725)}]);