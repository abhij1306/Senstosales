(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18391,e=>{"use strict";let t=(0,e.i(12063).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],18391)},28648,e=>{"use strict";let t=(0,e.i(12063).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>t],28648)},41334,e=>{"use strict";let t=(0,e.i(12063).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],41334)},48162,e=>{"use strict";let t=(0,e.i(12063).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);e.s(["Download",()=>t],48162)},70658,e=>{"use strict";var t=e.i(78722),r=e.i(89490),a=e.i(48162);function s({url:e,filename:s,label:i="Download Excel",className:n="",variant:l="outline",size:o="md"}){let[d,c]=(0,r.useState)(!1),m=async t=>{t.preventDefault(),t.stopPropagation(),c(!0);try{let t=await fetch(e,{method:"GET"});if(!t.ok)throw Error("Download failed");let r=await t.blob(),a=window.URL.createObjectURL(r),i=document.createElement("a");i.href=a,i.download=s,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(a)}catch(e){console.error("Download Error:",e),alert("Failed to download file. Please try again.")}finally{c(!1)}},p="sm"===o?"w-3 h-3":"lg"===o?"w-5 h-5":"w-4 h-4";return(0,t.jsxs)("button",{onClick:m,disabled:d,className:`inline-flex items-center gap-2 font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${{sm:"px-2.5 py-1 text-xs",md:"px-3 py-1.5 text-sm",lg:"px-4 py-2 text-base"}[o]} ${{primary:"bg-blue-600 text-white hover:bg-blue-700",secondary:"bg-gray-100 text-gray-700 hover:bg-gray-200",outline:"border border-gray-300 text-text-primary bg-white hover:bg-gray-50",ghost:"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}[l]} ${n} ${d?"opacity-70 cursor-wait":""}`,children:[d?(0,t.jsxs)("svg",{className:`animate-spin -ml-1 mr-2 ${p} text-current`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,t.jsx)(a.Download,{className:p}),i]})}e.s(["default",()=>s])},97968,e=>{"use strict";let t=(0,e.i(12063).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>t],97968)},83778,e=>{"use strict";let t=(0,e.i(12063).default)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);e.s(["Edit2",()=>t],83778)},94029,e=>{"use strict";var t=e.i(78722),r=e.i(89490),a=e.i(69244),s=e.i(18391),i=e.i(83778),n=e.i(28648),l=e.i(35073),o=e.i(10496),d=e.i(85257),c=e.i(97968),m=e.i(61071),p=e.i(41334),x=e.i(93889),h=e.i(70658);let u=[{id:"t1",title:"Standard Dispatch Note",content:"Material is being dispatched against PO No: ... dated ..."},{id:"t2",title:"Warranty Note",content:"Standard Manufacturer Warranty applicable."},{id:"t3",title:"Inspection Note",content:"Material inspected by ... on ..."},{id:"t4",title:"Excise Gate Pass",content:"Excise Gate Pass No: ... Date: ..."}];function b(){let e=(0,a.useRouter)(),b=(0,a.useSearchParams)().get("id"),[g,y]=(0,r.useState)(!0),[_,f]=(0,r.useState)(!1),[v,j]=(0,r.useState)("basic"),[N,w]=(0,r.useState)(!1),[C,k]=(0,r.useState)(null),[S,D]=(0,r.useState)(null),[M,q]=(0,r.useState)([]),[$,P]=(0,r.useState)([]),[T,A]=(0,r.useState)(""),[E,L]=(0,r.useState)({dc_number:"",dc_date:"",po_number:"",supplier_phone:"0755 – 4247748",supplier_gstin:"23AACFS6810L1Z7",consignee_name:"The Sr. Manager (CRX)",consignee_address:"M/S Bharat Heavy Eletrical Ltd. Bhopal",department_no:"",mode_of_transport:"",vehicle_number:"",transporter_name:"",lr_number:"",eway_bill_number:""});(0,r.useEffect)(()=>{b&&(async()=>{try{let e=await x.api.getDCDetail(b);if(e.header){if(L({dc_number:e.header.dc_number||"",dc_date:e.header.dc_date||"",po_number:e.header.po_number?.toString()||"",supplier_phone:e.header.supplier_phone||"0755 – 4247748",supplier_gstin:e.header.supplier_gstin||"23AACFS6810L1Z7",consignee_name:e.header.consignee_name||"The Sr. Manager (CRX)",consignee_address:e.header.consignee_address||"M/S Bharat Heavy Eletrical Ltd. Bhopal",department_no:e.header.department_no?.toString()||"",mode_of_transport:e.header.mode_of_transport||"",vehicle_number:e.header.vehicle_no||"",transporter_name:e.header.transporter||"",lr_number:e.header.lr_no||"",eway_bill_number:e.header.eway_bill_no||""}),e.items&&e.items.length>0){let t=e.items.map((e,t)=>({id:`item-${t}`,lot_no:e.lot_no?.toString()||(t+1).toString(),description:e.material_description||e.description||"",ordered_quantity:e.lot_ordered_qty||e.ordered_qty||0,remaining_post_dc:e.remaining_post_dc||0,dispatch_quantity:e.dispatch_qty||e.dispatch_quantity||0,po_item_id:e.po_item_id}));q(t)}else e.header.po_number&&await R(e.header.po_number.toString());e.header.remarks&&P([...e.header.remarks.split("\n\n")])}let t=await x.api.checkDCHasInvoice(b);t&&t.has_invoice&&(w(!0),k(t.invoice_number||null)),y(!1)}catch(e){console.error("Failed to load DC:",e),D(e instanceof Error?e.message:"Failed to load DC"),y(!1)}})()},[b]);let R=async e=>{try{let t=await x.api.getReconciliation(parseInt(e));if(t){let e=t.map((e,t)=>({id:`item-${t}`,lot_no:e.lot_no?.toString()||(t+1).toString(),description:e.material_description||"",ordered_quantity:e.ordered_quantity||e.ordered_qty||0,remaining_post_dc:e.remaining_quantity||e.remaining_qty||0,dispatch_quantity:0,po_item_id:e.po_item_id}));q(e)}}catch(e){console.error("Failed to fetch PO items:",e)}},F=(e,t,r)=>{q(M.map(a=>a.id===e?{...a,[t]:r}:a))},I=async()=>{try{y(!0);let e={dc_number:E.dc_number,dc_date:E.dc_date,po_number:E.po_number?parseInt(E.po_number):void 0,consignee_name:E.consignee_name,consignee_address:E.consignee_address,vehicle_no:E.vehicle_number,lr_no:E.lr_number,transporter:E.transporter_name,mode_of_transport:E.mode_of_transport,eway_bill_number:E.eway_bill_number,remarks:$.join("\n\n")},t=M.map(e=>({po_item_id:e.po_item_id,lot_no:e.lot_no?parseInt(e.lot_no.toString()):void 0,dispatch_qty:e.dispatch_quantity}));if(!b)return;await x.api.updateDC(b,e,t),f(!1),window.location.reload()}catch(e){console.error("Failed to update DC",e),D(e instanceof Error?e.message:"Failed to update DC")}finally{y(!1)}};if(g)return(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)("div",{className:"text-primary font-medium",children:"Loading..."})});let O=({label:e,value:r,onChange:a,placeholder:s="",disabled:i=!1})=>(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-[11px] uppercase tracking-wider font-semibold text-text-secondary mb-1",children:e}),(0,t.jsx)("input",{type:"text",value:r,onChange:e=>a(e.target.value),placeholder:s,disabled:i||!_,className:`w-full px-3 py-2 text-sm border border-border rounded-lg focus:ring-1 focus:ring-primary focus:border-primary text-text-primary bg-white ${i||!_?"bg-gray-50 text-text-secondary":""}`})]});return(0,t.jsxs)("div",{className:"space-y-6 pb-24",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("button",{onClick:()=>e.back(),className:"text-text-secondary hover:text-text-primary p-1",children:(0,t.jsx)(s.ArrowLeft,{className:"w-5 h-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-[20px] font-semibold text-text-primary flex items-center gap-3",children:["Delivery Challan ",E.dc_number,E.po_number&&(0,t.jsxs)("span",{className:"text-[11px] font-medium text-text-secondary bg-gray-100 px-2 py-0.5 rounded border border-border flex items-center gap-1",children:["PO: ",(0,t.jsx)("button",{onClick:()=>e.push(`/po/view?id=${E.po_number}`),className:"text-primary hover:underline",children:E.po_number})]})]}),(0,t.jsxs)("p",{className:"text-[13px] text-text-secondary mt-0.5",children:["Date: ",E.dc_date]})]})]}),(0,t.jsx)("div",{className:"flex gap-3",children:_?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("button",{onClick:()=>f(!1),className:"px-4 py-2 text-sm font-medium text-text-secondary bg-white border border-border rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2",children:[(0,t.jsx)(l.X,{className:"w-4 h-4"})," Cancel"]}),(0,t.jsxs)("button",{onClick:I,className:"px-4 py-2 text-sm font-medium bg-primary text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 shadow-sm",children:[(0,t.jsx)(n.Save,{className:"w-4 h-4"})," Save"]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.default,{url:`${x.API_BASE_URL}/api/dc/${E.dc_number}/download`,filename:`DC_${E.dc_number}.xlsx`,label:"Download Challan"}),(0,t.jsxs)("button",{onClick:()=>{N&&C?e.push(`/invoice/view?id=${C}`):e.push(`/invoice/create?dc=${b}`)},className:`px-4 py-2 text-sm font-medium text-white rounded-lg flex items-center gap-2 shadow-sm transition-colors ${N?"bg-primary hover:bg-blue-700":"bg-success hover:bg-green-700"}`,children:[(0,t.jsx)(o.FileText,{className:"w-4 h-4"}),N?"View Invoice":"Create Invoice"]}),(0,t.jsxs)("button",{onClick:()=>f(!0),disabled:N,className:"px-4 py-2 text-sm font-medium bg-white text-text-primary border border-border rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition-colors",title:N?"Cannot edit DC - already has invoice":"",children:[(0,t.jsx)(i.Edit2,{className:"w-4 h-4"})," Edit"]})]})})]}),S&&(0,t.jsxs)("div",{className:"bg-red-50 border border-red-100 rounded-lg p-3 flex items-start gap-3 text-danger",children:[(0,t.jsx)(p.AlertCircle,{className:"w-5 h-5 shrink-0 mt-0.5"}),(0,t.jsx)("p",{className:"text-sm font-medium",children:S})]}),(0,t.jsxs)("div",{className:"glass-card overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex border-b border-border bg-gray-50/30 px-4 pt-1",children:[(0,t.jsx)("button",{onClick:()=>j("basic"),className:`px-4 py-3 text-[13px] font-semibold transition-all relative top-[1px] border-b-2 mr-2 ${"basic"===v?"border-primary text-primary bg-transparent":"border-transparent text-text-secondary hover:text-text-primary"}`,children:"Basic Info"}),(0,t.jsx)("button",{onClick:()=>j("transport"),className:`px-4 py-3 text-[13px] font-semibold transition-all relative top-[1px] border-b-2 ${"transport"===v?"border-primary text-primary bg-transparent":"border-transparent text-text-secondary hover:text-text-primary"}`,children:"Transport Details"})]}),(0,t.jsxs)("div",{className:"p-6",children:["basic"===v&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,t.jsx)(O,{label:"DC Number",value:E.dc_number,onChange:e=>L({...E,dc_number:e}),disabled:!0}),(0,t.jsx)(O,{label:"DC Date",value:E.dc_date,onChange:e=>L({...E,dc_date:e})}),(0,t.jsx)(O,{label:"Supplier Phone No",value:E.supplier_phone,onChange:e=>L({...E,supplier_phone:e})}),(0,t.jsx)(O,{label:"Supplier GSTIN",value:E.supplier_gstin,onChange:e=>L({...E,supplier_gstin:e})}),(0,t.jsx)(O,{label:"Consignee Name",value:E.consignee_name,onChange:e=>L({...E,consignee_name:e})}),(0,t.jsxs)("div",{className:"col-span-1",children:[(0,t.jsx)("label",{className:"block text-[11px] uppercase tracking-wider font-semibold text-text-secondary mb-1",children:"Consignee Address"}),(0,t.jsx)("textarea",{value:E.consignee_address,onChange:e=>L({...E,consignee_address:e.target.value}),disabled:!_,rows:2,className:`w-full px-3 py-2 text-sm border border-border rounded-lg focus:ring-1 focus:ring-primary focus:border-primary text-text-primary bg-white ${!_?"bg-gray-50 text-text-secondary":""}`})]})]}),"transport"===v&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsx)(O,{label:"Mode of Transport",value:E.mode_of_transport,onChange:e=>L({...E,mode_of_transport:e})}),(0,t.jsx)(O,{label:"Vehicle Number",value:E.vehicle_number,onChange:e=>L({...E,vehicle_number:e})}),(0,t.jsx)(O,{label:"Transporter Name",value:E.transporter_name,onChange:e=>L({...E,transporter_name:e})}),(0,t.jsx)(O,{label:"LR Number",value:E.lr_number,onChange:e=>L({...E,lr_number:e})}),(0,t.jsx)(O,{label:"E-Way Bill Number",value:E.eway_bill_number,onChange:e=>L({...E,eway_bill_number:e})})]})]})]}),(0,t.jsxs)("div",{className:"glass-card overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-border bg-gray-50/30",children:[(0,t.jsxs)("h3",{className:"text-[14px] font-semibold text-text-primary flex items-center gap-2",children:[(0,t.jsx)(m.Truck,{className:"w-4 h-4 text-primary"}),"Items Dispatched"]}),_&&(0,t.jsxs)("button",{onClick:()=>{alert("Adding items to existing DC is mostly restricted to existing PO lots. Please create new DC for new items or ensure you map PO Item ID correctly.")},className:"text-primary hover:text-blue-700 text-xs font-medium flex items-center gap-1 transition-colors",children:[(0,t.jsx)(d.Plus,{className:"w-3.5 h-3.5"})," Add Row"]})]}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-left border-collapse",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50/50 text-text-secondary border-b border-border text-[11px] uppercase tracking-wider font-semibold",children:[(0,t.jsx)("th",{className:"px-4 py-3 w-16",children:"Lot"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"Description"}),(0,t.jsx)("th",{className:"px-4 py-3 w-24 text-right",children:"Ordered"}),(0,t.jsx)("th",{className:"px-4 py-3 w-24 text-right",children:"Rem."}),(0,t.jsx)("th",{className:"px-4 py-3 w-32 text-right",children:"Dispatch"}),_&&(0,t.jsx)("th",{className:"px-4 py-3 w-16 text-center"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-border/50 bg-white",children:M.length>0?M.map((e,r)=>(0,t.jsxs)("tr",{className:"group hover:bg-gray-50/50 transition-colors",children:[(0,t.jsx)("td",{className:"px-4 py-2",children:_?(0,t.jsx)("input",{type:"text",value:e.lot_no,onChange:t=>F(e.id,"lot_no",t.target.value),className:"w-full border border-border rounded px-2 py-1 focus:ring-1 focus:ring-primary text-sm bg-white",readOnly:!0}):(0,t.jsx)("span",{className:"text-sm font-medium text-text-primary",children:e.lot_no})}),(0,t.jsx)("td",{className:"px-4 py-2",children:_?(0,t.jsx)("input",{type:"text",value:e.description,onChange:t=>F(e.id,"description",t.target.value),className:"w-full border border-border rounded px-2 py-1 focus:ring-1 focus:ring-primary text-sm bg-white",readOnly:!0}):(0,t.jsx)("span",{className:"text-sm text-text-primary line-clamp-1",title:e.description,children:e.description})}),(0,t.jsx)("td",{className:"px-4 py-2 text-right text-[13px] text-text-secondary font-medium",children:e.ordered_quantity}),(0,t.jsx)("td",{className:"px-4 py-2 text-right text-[13px] text-text-primary font-bold",children:e.remaining_post_dc}),(0,t.jsx)("td",{className:"px-4 py-2",children:_?(0,t.jsx)("input",{type:"number",value:e.dispatch_quantity,onChange:t=>F(e.id,"dispatch_quantity",parseFloat(t.target.value)),className:"w-full border border-primary/30 rounded px-2 py-1 font-bold text-primary text-sm text-right bg-white focus:ring-1 focus:ring-primary",placeholder:"0"}):(0,t.jsx)("div",{className:"text-right font-bold text-primary text-[13px]",children:e.dispatch_quantity})}),_&&(0,t.jsx)("td",{className:"px-4 py-2 text-center",children:(0,t.jsx)("button",{onClick:()=>{var t;return t=e.id,void q(M.filter(e=>e.id!==t))},className:"text-text-secondary hover:text-danger p-1.5 rounded transition-colors hover:bg-red-50",children:(0,t.jsx)(c.Trash2,{className:"w-3.5 h-3.5"})})})]},r)):(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:_?6:5,className:"text-center py-8 text-text-secondary text-sm italic",children:"No items found."})})})]})})]}),(0,t.jsxs)("div",{className:"glass-card p-4",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("h3",{className:"text-[14px] font-semibold text-text-primary flex items-center gap-2",children:[(0,t.jsx)(o.FileText,{className:"w-4 h-4 text-primary"}),"PO Notes"]}),(0,t.jsx)("p",{className:"text-[12px] text-text-secondary mt-0.5",children:"Standard terms and conditions for this delivery."})]}),_&&(0,t.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,t.jsxs)("div",{className:"flex-1 relative",children:[(0,t.jsxs)("select",{value:T,onChange:e=>A(e.target.value),className:"w-full appearance-none px-3 py-2 border border-border rounded-lg text-sm bg-white focus:outline-none focus:ring-1 focus:ring-primary cursor-pointer text-text-primary",children:[(0,t.jsx)("option",{value:"",children:"-- Select Note Template --"}),u.map(e=>(0,t.jsx)("option",{value:e.id,children:e.title},e.id))]}),(0,t.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-text-secondary",children:(0,t.jsx)(d.Plus,{className:"h-4 w-4 rotate-45"})})]}),(0,t.jsx)("button",{onClick:()=>{let e=u.find(e=>e.id===T);e&&(P([...$,e.content]),A(""))},disabled:!T,className:"px-4 py-2 bg-text-primary text-white rounded-lg hover:bg-black text-sm font-medium disabled:opacity-50 disabled:bg-gray-300 transition-colors",children:"Add Note"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[$.map((e,r)=>(0,t.jsxs)("div",{className:"flex gap-3 items-start group",children:[(0,t.jsx)("textarea",{value:e,onChange:e=>{var t;let a;return t=e.target.value,void((a=[...$])[r]=t,P(a))},rows:2,disabled:!_,className:`flex-1 border border-border rounded-lg text-sm text-text-primary py-2 px-3 focus:ring-1 focus:ring-primary focus:border-primary transition-all bg-white ${!_?"bg-gray-50 text-text-secondary border-transparent":""}`}),_&&(0,t.jsx)("button",{onClick:()=>{let e;(e=[...$]).splice(r,1),P(e)},className:"mt-2 text-text-secondary hover:text-danger p-1 transition-colors",children:(0,t.jsx)(c.Trash2,{className:"w-4 h-4"})})]},r)),0===$.length&&(0,t.jsx)("div",{className:"text-center py-6 bg-gray-50/50 rounded-lg border border-dashed border-border text-text-secondary text-sm",children:"No notes added yet."})]})]})]})}function g(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)("div",{className:"text-primary font-medium",children:"Loading..."})}),children:(0,t.jsx)(b,{})})}e.s(["default",()=>g])}]);